<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎰 Рулетка 3Я</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Шапка */
        .header {
            background: linear-gradient(90deg, #FF416C 0%, #FF4B2B 100%);
            padding: 20px 15px;
            text-align: center;
            position: relative;
            box-shadow: 0 4px 12px rgba(255, 65, 108, 0.3);
        }

        .header h1 {
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .close-btn {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
        }

        /* Основной контейнер */
        .container {
            padding: 20px 15px 80px;
            max-width: 500px;
            margin: 0 auto;
        }

        /* Секция с билетами */
        .tickets-section {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 15px;
            margin-bottom: 25px;
            text-align: center;
            border: 2px solid #FF416C;
        }

        .tickets-label {
            font-size: 14px;
            color: #aaa;
            margin-bottom: 5px;
        }

        .tickets-count {
            font-size: 36px;
            font-weight: bold;
            color: #FFD700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        /* Рулетка */
        .roulette-container {
            background: rgba(0,0,0,0.3);
            border-radius: 25px;
            padding: 25px;
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
            border: 3px solid #FF416C;
        }

        .roulette-title {
            text-align: center;
            font-size: 18px;
            margin-bottom: 20px;
            color: #FFD700;
        }

        .roulette-wheel {
            width: 280px;
            height: 280px;
            margin: 0 auto;
            position: relative;
            background: conic-gradient(
                #FF416C 0deg 30deg,
                #FF4B2B 30deg 60deg,
                #FFD700 60deg 90deg,
                #4CAF50 90deg 120deg,
                #2196F3 120deg 150deg,
                #9C27B0 150deg 180deg,
                #FF416C 180deg 210deg,
                #FF4B2B 210deg 240deg,
                #FFD700 240deg 270deg,
                #4CAF50 270deg 300deg,
                #2196F3 300deg 330deg,
                #9C27B0 330deg 360deg
            );
            border-radius: 50%;
            border: 8px solid #fff;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            transition: transform 3s cubic-bezier(0.2, 0.8, 0.3, 1);
        }

        .roulette-pointer {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 30px solid #FF416C;
            z-index: 10;
            filter: drop-shadow(0 0 5px rgba(255,65,108,0.7));
        }

        .roulette-segments {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }

        .segment {
            position: absolute;
            width: 50%;
            height: 2px;
            background: white;
            left: 50%;
            top: 50%;
            transform-origin: 0% 0%;
            opacity: 0.7;
        }

        .segment-value {
            position: absolute;
            color: white;
            font-weight: bold;
            text-shadow: 1px 1px 3px black;
            font-size: 18px;
        }

        /* Секции призов */
        .prizes-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 25px;
        }

        .prize-card {
            background: linear-gradient(135deg, #2a2a4e 0%, #1a1a3e 100%);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 2px solid;
            transition: transform 0.3s;
            position: relative;
            overflow: hidden;
        }

        .prize-card:hover {
            transform: translateY(-5px);
        }

        .prize-card.gold {
            border-color: #FFD700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
        }

        .prize-card.silver {
            border-color: #C0C0C0;
            box-shadow: 0 0 15px rgba(192, 192, 192, 0.3);
        }

        .prize-card.bronze {
            border-color: #CD7F32;
            box-shadow: 0 0 15px rgba(205, 127, 50, 0.3);
        }

        .prize-amount {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .prize-card.gold .prize-amount {
            color: #FFD700;
        }

        .prize-card.silver .prize-amount {
            color: #C0C0C0;
        }

        .prize-card.bronze .prize-amount {
            color: #CD7F32;
        }

        .prize-name {
            font-size: 14px;
            color: #aaa;
        }

        /* Кнопка спина */
        .spin-button {
            background: linear-gradient(90deg, #FF416C 0%, #FF4B2B 100%);
            color: white;
            border: none;
            width: 100%;
            padding: 22px;
            font-size: 20px;
            font-weight: bold;
            border-radius: 15px;
            cursor: pointer;
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            box-shadow: 0 8px 20px rgba(255, 65, 108, 0.4);
            transition: all 0.3s;
        }

        .spin-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(255, 65, 108, 0.6);
        }

        .spin-button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Модальные окна */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: linear-gradient(135deg, #2a2a4e 0%, #1a1a3e 100%);
            border-radius: 25px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            border: 3px solid #FF416C;
            animation: modalAppear 0.5s;
        }

        @keyframes modalAppear {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .win-modal .modal-content {
            border-color: #FFD700;
        }

        .lose-modal .modal-content {
            border-color: #666;
        }

        .modal-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }

        .win-modal .modal-icon {
            color: #FFD700;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .modal-title {
            font-size: 28px;
            margin-bottom: 15px;
            color: #FFD700;
        }

        .lose-modal .modal-title {
            color: #aaa;
        }

        .modal-text {
            font-size: 18px;
            margin-bottom: 25px;
            color: #ccc;
        }

        .modal-button {
            background: #FF416C;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 10px;
        }

        /* Нижнее меню */
        .bottom-menu {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(26,26,46,0.95);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-around;
            padding: 15px 0;
            border-top: 1px solid #333;
            z-index: 100;
        }

        .menu-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #aaa;
            text-decoration: none;
            font-size: 12px;
            transition: color 0.3s;
        }

        .menu-item.active {
            color: #FF416C;
        }

        .menu-item i {
            font-size: 22px;
            margin-bottom: 5px;
        }

        /* Анимации */
        @keyframes fall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 0; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 1; }
        }

        .confetti {
            position: fixed;
            width: 15px;
            height: 15px;
            pointer-events: none;
            z-index: 999;
        }

        .winning-card {
            animation: cardFly 2s forwards;
            position: fixed;
            z-index: 999;
        }

        @keyframes cardFly {
            0% { transform: scale(1) translate(0, 0); opacity: 1; }
            100% { transform: scale(0.3) translate(200px, -300px); opacity: 0; }
        }

        /* История и другие секции */
        .history-section, .friends-section, .collection-section {
            display: none;
        }

        .history-item, .friend-item {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid #FF416C;
        }

        .history-item.lose {
            border-left-color: #666;
        }

        .history-item.win {
            border-left-color: #4CAF50;
        }

        .friend-avatar {
            width: 40px;
            height: 40px;
            background: #FF416C;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Адаптивность */
        @media (max-width: 400px) {
            .roulette-wheel {
                width: 250px;
                height: 250px;
            }
            
            .prize-card {
                padding: 15px;
            }
            
            .prize-amount {
                font-size: 26px;
            }
        }
    </style>
</head>
<body>
    <!-- Шапка -->
    <div class="header">
        <h1>🎰 Рулетка 3Я</h1>
        <button class="close-btn" onclick="closeApp()">✕</button>
    </div>

    <!-- Основной контейнер -->
    <div class="container">
        <!-- Секция с билетами -->
        <div class="tickets-section">
            <div class="tickets-label">ваши билеты:</div>
            <div class="tickets-count">
                <i class="fas fa-ticket-alt"></i>
                <span id="ticketCount">3</span>
            </div>
        </div>

        <!-- Рулетка -->
        <div class="roulette-container">
            <div class="roulette-title">🎡 КРУТИ И ВЫИГРЫВАЙ!</div>
            <div class="roulette-wheel" id="rouletteWheel">
                <div class="roulette-pointer"></div>
                <div class="roulette-segments" id="rouletteSegments"></div>
            </div>

            <!-- Сетка призов -->
            <div class="prizes-grid">
                <div class="prize-card gold">
                    <div class="prize-amount">3000₽</div>
                    <div class="prize-name">Золотой приз</div>
                </div>
                <div class="prize-card silver">
                    <div class="prize-amount">1000₽</div>
                    <div class="prize-name">Серебряный приз</div>
                </div>
                <div class="prize-card bronze">
                    <div class="prize-amount">500₽</div>
                    <div class="prize-name">Бронзовый приз</div>
                </div>
                <div class="prize-card">
                    <div class="prize-amount">300₽</div>
                    <div class="prize-name">Базовый приз</div>
                </div>
            </div>

            <!-- Кнопка спина -->
            <button class="spin-button" id="spinButton" onclick="spinRoulette()">
                <i class="fas fa-redo"></i>
                КРУТИТЬ РУЛЕТКУ
            </button>
        </div>

        <!-- Другие секции (скрыты по умолчанию) -->
        <div class="history-section" id="historySection">
            <h2>📜 История вращений</h2>
            <div id="historyList"></div>
        </div>

        <div class="friends-section" id="friendsSection">
            <h2>👥 Приглашай друзей</h2>
            <p>Получай +1 билет за каждого приглашенного друга</p>
            <div class="referral-link">
                <input type="text" id="refLink" readonly value="Загрузка...">
                <button onclick="copyRefLink()">📋 Копировать</button>
            </div>
            <div id="friendsList"></div>
        </div>

        <div class="collection-section" id="collectionSection">
            <h2>🏆 Коллекция выигрышей</h2>
            <div id="collectionList"></div>
        </div>
    </div>

    <!-- Нижнее меню -->
    <div class="bottom-menu">
        <a href="#" class="menu-item active" onclick="showSection('main')">
            <i class="fas fa-home"></i>
            <span>Главная</span>
        </a>
        <a href="#" class="menu-item" onclick="showSection('history')">
            <i class="fas fa-history"></i>
            <span>История</span>
        </a>
        <a href="#" class="menu-item" onclick="showSection('friends')">
            <i class="fas fa-user-friends"></i>
            <span>Друзья</span>
        </a>
        <a href="#" class="menu-item" onclick="showSection('collection')">
            <i class="fas fa-trophy"></i>
            <span>Коллекция</span>
        </a>
    </div>

    <!-- Модальное окно победы -->
    <div class="modal win-modal" id="winModal">
        <div class="modal-content">
            <div class="modal-icon">🎉</div>
            <div class="modal-title">ПОБЕДА!</div>
            <div class="modal-text" id="winPrizeText">Вы выиграли 500₽!</div>
            <button class="modal-button" onclick="closeModal('winModal')">УРА!</button>
        </div>
    </div>

    <!-- Модальное окно проигрыша -->
    <div class="modal lose-modal" id="loseModal">
        <div class="modal-content">
            <div class="modal-icon">😔</div>
            <div class="modal-title">НЕ РАССТРАИВАЙСЯ!</div>
            <div class="modal-text">
                Билеты закончились, но ты сможешь попробовать снова в 13:00 по мск или пригласить друзей, чтобы получить новые шансы!
            </div>
            <button class="modal-button" onclick="closeModal('loseModal')">ХОРОШО</button>
        </div>
    </div>

    <script>
        // Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        // Данные приложения
        let tickets = 3;
        let isSpinning = false;
        let history = [];
        let collection = [];
        let friends = [];

        // Призы рулетки
        const prizes = [
            { amount: "300₽", value: 300, type: "prize", color: "#FF416C" },
            { amount: "500₽", value: 500, type: "prize", color: "#FF4B2B" },
            { amount: "1000₽", value: 1000, type: "prize", color: "#FFD700" },
            { amount: "3000₽", value: 3000, type: "prize", color: "#4CAF50" },
            { amount: "0", value: 0, type: "lose", color: "#666" },
            { amount: "🎫 +1", value: 1, type: "ticket", color: "#2196F3" },
            { amount: "🎫 +3", value: 3, type: "ticket", color: "#9C27B0" },
            { amount: "🎫 +5", value: 5, type: "ticket", color: "#FF416C" }
        ];

        // Инициализация
        document.addEventListener('DOMContentLoaded', function() {
            // Создаем сегменты рулетки
            createRouletteSegments();
            
            // Загружаем данные пользователя
            loadUserData();
            
            // Показываем главный экран
            showSection('main');
        });

        // Создание сегментов рулетки
        function createRouletteSegments() {
            const segmentsContainer = document.getElementById('rouletteSegments');
            segmentsContainer.innerHTML = '';
            
            for (let i = 0; i < 12; i++) {
                // Линия сегмента
                const segment = document.createElement('div');
                segment.className = 'segment';
                segment.style.transform = `rotate(${i * 30}deg)`;
                segmentsContainer.appendChild(segment);
                
                // Значение сегмента
                const value = document.createElement('div');
                value.className = 'segment-value';
                const prize = prizes[i % prizes.length];
                value.textContent = prize.amount;
                value.style.color = prize.color;
                value.style.transform = `rotate(${i * 30 + 15}deg) translate(100px) rotate(${-(i * 30 + 15)}deg)`;
                segmentsContainer.appendChild(value);
            }
        }

        // Загрузка данных пользователя
        function loadUserData() {
            const user = tg.initDataUnsafe.user;
            const userId = user?.id || 'unknown';
            
            // Реферальная ссылка
            document.getElementById('refLink').value = `https://t.me/rullet_golden_bot?start=ref_${userId}`;
            
            // Загрузка истории и коллекции
            loadHistory();
            loadCollection();
            loadFriends();
        }

        // Вращение рулетки
        function spinRoulette() {
            if (isSpinning) return;
            if (tickets <= 0) {
                showModal('loseModal');
                return;
            }
            
            // Начинаем вращение
            isSpinning = true;
            tickets--;
            updateTickets();
            
            const spinButton = document.getElementById('spinButton');
            const wheel = document.getElementById('rouletteWheel');
            spinButton.disabled = true;
            
            // Анимация вращения
            const spins = 5 + Math.random() * 3; // 5-8 полных оборотов
            const winningSegment = Math.floor(Math.random() * prizes.length);
            const degrees = spins * 360 + (winningSegment * 30) + 15; // Останавливаемся на середине сегмента
            
            wheel.style.transform = `rotate(${degrees}deg)`;
            
            // Задержка для завершения анимации
            setTimeout(() => {
                const prize = prizes[winningSegment];
                handlePrize(prize);
                
                // Добавляем в историю
                addToHistory(prize);
                
                isSpinning = false;
                spinButton.disabled = false;
                
                // Сбрасываем рулетку через 2 секунды
                setTimeout(() => {
                    wheel.style.transform = 'rotate(0deg)';
                }, 2000);
            }, 3000);
        }

        // Обработка выигрыша
        function handlePrize(prize) {
            if (prize.type === 'lose') {
                showModal('loseModal');
            } else {
                if (prize.type === 'ticket') {
                    tickets += prize.value;
                    updateTickets();
                } else if (prize.type === 'prize') {
                    addToCollection(prize);
                    showWinAnimation(prize);
                }
                
                document.getElementById('winPrizeText').textContent = `Вы выиграли ${prize.amount}!`;
                showModal('winModal');
            }
        }

        // Показ анимации победы
        function showWinAnimation(prize) {
            // Конфетти
            confetti({
                particleCount: 150,
                spread: 70,
                origin: { y: 0.6 }
            });
            
            // Анимация падающей карточки
            const card = document.createElement('div');
            card.className = 'winning-card';
            card.style.background = prize.color;
            card.style.width = '100px';
            card.style.height = '60px';
            card.style.borderRadius = '10px';
            card.style.display = 'flex';
            card.style.alignItems = 'center';
            card.style.justifyContent = 'center';
            card.style.color = 'white';
            card.style.fontWeight = 'bold';
            card.style.fontSize = '20px';
            card.textContent = prize.amount;
            card.style.top = '50%';
            card.style.left = '50%';
            card.style.transform = 'translate(-50%, -50%)';
            
            document.body.appendChild(card);
            
            // Убираем карточку после анимации
            setTimeout(() => {
                card.remove();
            }, 2000);
        }

        // Обновление счетчика билетов
        function updateTickets() {
            document.getElementById('ticketCount').textContent = tickets;
        }

        // Добавление в историю
        function addToHistory(prize) {
            const historyItem = {
                date: new Date().toLocaleString('ru-RU'),
                prize: prize.amount,
                type: prize.type === 'lose' ? 'lose' : 'win'
            };
            
            history.unshift(historyItem);
            if (history.length > 10) history.pop();
            
            saveHistory();
            loadHistory();
        }

        // Загрузка истории
        function loadHistory() {
            const historyList = document.getElementById('historyList');
            if (!historyList) return;
            
            historyList.innerHTML = '';
            
            history.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = `history-item ${item.type}`;
                div.innerHTML = `
                    <div>
                        <strong>${item.prize}</strong>
                        <div style="font-size: 12px; color: #aaa;">${item.date}</div>
                    </div>
                    <div style="font-size: 24px; color: ${item.type === 'win' ? '#4CAF50' : '#666'}">
                        ${item.type === 'win' ? '🏆' : '😔'}
                    </div>
                `;
                historyList.appendChild(div);
            });
        }

        // Добавление в коллекцию
        function addToCollection(prize) {
            const collectionItem = {
                id: Date.now(),
                amount: prize.amount,
                value: prize.value,
                date: new Date().toLocaleDateString('ru-RU'),
                type: 'card'
            };
            
            collection.unshift(collectionItem);
            saveCollection();
            loadCollection();
        }

        // Загрузка коллекции
        function loadCollection() {
            const collectionList = document.getElementById('collectionList');
            if (!collectionList) return;
            
            collectionList.innerHTML = '';
            
            collection.forEach(item => {
                const div = document.createElement('div');
                div.className = 'prize-card';
                div.style.borderColor = item.type === 'card' ? '#FFD700' : '#4CAF50';
                div.innerHTML = `
                    <div class="prize-amount">${item.amount}</div>
                    <div class="prize-name">${item.type === 'card' ? 'Электронная карта' : 'Билеты'}</div>
                    <div style="font-size: 12px; color: #aaa; margin-top: 5px;">${item.date}</div>
                `;
                collectionList.appendChild(div);
            });
        }

        // Загрузка друзей
        function loadFriends() {
            const friendsList = document.getElementById('friendsList');
            if (!friendsList) return;
            
            if (friends.length === 0) {
                friendsList.innerHTML = '<p style="text-align: center; color: #aaa; padding: 20px;">Пока пусто. Здесь будет список друзей</p>';
            }
        }

        // Показать секцию
        function showSection(section) {
            // Скрываем все секции
            document.querySelectorAll('.container > div').forEach(div => {
                if (div.classList.contains('roulette-container') || 
                    div.classList.contains('history-section') || 
                    div.classList.contains('friends-section') || 
                    div.classList.contains('collection-section')) {
                    div.style.display = 'none';
                }
            });
            
            // Показываем нужную секцию
            if (section === 'main') {
                document.querySelector('.roulette-container').style.display = 'block';
            } else if (section === 'history') {
                document.getElementById('historySection').style.display = 'block';
            } else if (section === 'friends') {
                document.getElementById('friendsSection').style.display = 'block';
            } else if (section === 'collection') {
                document.getElementById('collectionSection').style.display = 'block';
            }
            
            // Обновляем активное меню
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            document.querySelectorAll('.menu-item')[{
                'main': 0, 'history': 1, 'friends': 2, 'collection': 3
            }[section]].classList.add('active');
        }

        // Показать модальное окно
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        // Закрыть модальное окно
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Закрыть приложение
        function closeApp() {
            tg.close();
        }

        // Копировать реферальную ссылку
        function copyRefLink() {
            const refLink = document.getElementById('refLink');
            refLink.select();
            refLink.setSelectionRange(0, 99999);
            document.execCommand('copy');
            alert('Ссылка скопирована!');
        }

        // Сохранение данных в localStorage (для демо)
        function saveHistory() {
            localStorage.setItem('roulette_history', JSON.stringify(history));
        }

        function saveCollection() {
            localStorage.setItem('roulette_collection', JSON.stringify(collection));
        }

        // Загрузка данных из localStorage (для демо)
        function loadUserData() {
            const savedHistory = localStorage.getItem('roulette_history');
            const savedCollection = localStorage.getItem('roulette_collection');
            
            if (savedHistory) history = JSON.parse(savedHistory);
            if (savedCollection) collection = JSON.parse(savedCollection);
            
            // Реферальная ссылка
            const user = tg.initDataUnsafe.user || {};
            const refLink = `https://t.me/rullet_golden_bot?start=ref_${user.id || 'demo'}`;
            document.getElementById('refLink').value = refLink;
            
            updateTickets();
            loadHistory();
            loadCollection();
        }
    </script>
</body>
</html>