<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé∞ –†—É–ª–µ—Ç–∫–∞ 3–Ø</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* –®–∞–ø–∫–∞ */
        .header {
            background: linear-gradient(90deg, #FF416C 0%, #FF4B2B 100%);
            padding: 20px 15px;
            text-align: center;
            position: relative;
            box-shadow: 0 4px 12px rgba(255, 65, 108, 0.3);
        }

        .header h1 {
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .close-btn {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .container {
            padding: 20px 15px 80px;
            max-width: 500px;
            margin: 0 auto;
        }

        /* –°–µ–∫—Ü–∏—è —Å –±–∏–ª–µ—Ç–∞–º–∏ */
        .tickets-section {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 15px;
            margin-bottom: 25px;
            text-align: center;
            border: 2px solid #FF416C;
        }

        .tickets-label {
            font-size: 14px;
            color: #aaa;
            margin-bottom: 5px;
        }

        .tickets-count {
            font-size: 36px;
            font-weight: bold;
            color: #FFD700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        /* –†—É–ª–µ—Ç–∫–∞ */
        .roulette-container {
            background: rgba(0,0,0,0.3);
            border-radius: 25px;
            padding: 25px;
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
            border: 3px solid #FF416C;
        }

        .roulette-title {
            text-align: center;
            font-size: 18px;
            margin-bottom: 20px;
            color: #FFD700;
        }

        .roulette-wheel {
            width: 280px;
            height: 280px;
            margin: 0 auto;
            position: relative;
            background: conic-gradient(
                #FF416C 0deg 30deg,
                #FF4B2B 30deg 60deg,
                #FFD700 60deg 90deg,
                #4CAF50 90deg 120deg,
                #2196F3 120deg 150deg,
                #9C27B0 150deg 180deg,
                #FF416C 180deg 210deg,
                #FF4B2B 210deg 240deg,
                #FFD700 240deg 270deg,
                #4CAF50 270deg 300deg,
                #2196F3 300deg 330deg,
                #9C27B0 330deg 360deg
            );
            border-radius: 50%;
            border: 8px solid #fff;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            transition: transform 3s cubic-bezier(0.2, 0.8, 0.3, 1);
        }

        .roulette-pointer {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 30px solid #FF416C;
            z-index: 10;
            filter: drop-shadow(0 0 5px rgba(255,65,108,0.7));
        }

        .roulette-segments {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }

        .segment {
            position: absolute;
            width: 50%;
            height: 2px;
            background: white;
            left: 50%;
            top: 50%;
            transform-origin: 0% 0%;
            opacity: 0.7;
        }

        .segment-value {
            position: absolute;
            color: white;
            font-weight: bold;
            text-shadow: 1px 1px 3px black;
            font-size: 18px;
        }

        /* –°–µ–∫—Ü–∏–∏ –ø—Ä–∏–∑–æ–≤ */
        .prizes-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 25px;
        }

        .prize-card {
            background: linear-gradient(135deg, #2a2a4e 0%, #1a1a3e 100%);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 2px solid;
            transition: transform 0.3s;
            position: relative;
            overflow: hidden;
        }

        .prize-card:hover {
            transform: translateY(-5px);
        }

        .prize-card.gold {
            border-color: #FFD700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
        }

        .prize-card.silver {
            border-color: #C0C0C0;
            box-shadow: 0 0 15px rgba(192, 192, 192, 0.3);
        }

        .prize-card.bronze {
            border-color: #CD7F32;
            box-shadow: 0 0 15px rgba(205, 127, 50, 0.3);
        }

        .prize-amount {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .prize-card.gold .prize-amount {
            color: #FFD700;
        }

        .prize-card.silver .prize-amount {
            color: #C0C0C0;
        }

        .prize-card.bronze .prize-amount {
            color: #CD7F32;
        }

        .prize-name {
            font-size: 14px;
            color: #aaa;
        }

        /* –ö–Ω–æ–ø–∫–∞ —Å–ø–∏–Ω–∞ */
        .spin-button {
            background: linear-gradient(90deg, #FF416C 0%, #FF4B2B 100%);
            color: white;
            border: none;
            width: 100%;
            padding: 22px;
            font-size: 20px;
            font-weight: bold;
            border-radius: 15px;
            cursor: pointer;
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            box-shadow: 0 8px 20px rgba(255, 65, 108, 0.4);
            transition: all 0.3s;
        }

        .spin-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(255, 65, 108, 0.6);
        }

        .spin-button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: linear-gradient(135deg, #2a2a4e 0%, #1a1a3e 100%);
            border-radius: 25px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            border: 3px solid #FF416C;
            animation: modalAppear 0.5s;
        }

        @keyframes modalAppear {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .win-modal .modal-content {
            border-color: #FFD700;
        }

        .lose-modal .modal-content {
            border-color: #666;
        }

        .modal-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }

        .win-modal .modal-icon {
            color: #FFD700;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .modal-title {
            font-size: 28px;
            margin-bottom: 15px;
            color: #FFD700;
        }

        .lose-modal .modal-title {
            color: #aaa;
        }

        .modal-text {
            font-size: 18px;
            margin-bottom: 25px;
            color: #ccc;
        }

        .modal-button {
            background: #FF416C;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 10px;
        }

        /* –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é */
        .bottom-menu {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(26,26,46,0.95);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-around;
            padding: 15px 0;
            border-top: 1px solid #333;
            z-index: 100;
        }

        .menu-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #aaa;
            text-decoration: none;
            font-size: 12px;
            transition: color 0.3s;
        }

        .menu-item.active {
            color: #FF416C;
        }

        .menu-item i {
            font-size: 22px;
            margin-bottom: 5px;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes fall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 0; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 1; }
        }

        .confetti {
            position: fixed;
            width: 15px;
            height: 15px;
            pointer-events: none;
            z-index: 999;
        }

        .winning-card {
            animation: cardFly 2s forwards;
            position: fixed;
            z-index: 999;
        }

        @keyframes cardFly {
            0% { transform: scale(1) translate(0, 0); opacity: 1; }
            100% { transform: scale(0.3) translate(200px, -300px); opacity: 0; }
        }

        /* –ò—Å—Ç–æ—Ä–∏—è –∏ –¥—Ä—É–≥–∏–µ —Å–µ–∫—Ü–∏–∏ */
        .history-section, .friends-section, .collection-section {
            display: none;
        }

        .history-item, .friend-item {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid #FF416C;
        }

        .history-item.lose {
            border-left-color: #666;
        }

        .history-item.win {
            border-left-color: #4CAF50;
        }

        .friend-avatar {
            width: 40px;
            height: 40px;
            background: #FF416C;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 400px) {
            .roulette-wheel {
                width: 250px;
                height: 250px;
            }
            
            .prize-card {
                padding: 15px;
            }
            
            .prize-amount {
                font-size: 26px;
            }
        }
    </style>
</head>
<body>
    <!-- –®–∞–ø–∫–∞ -->
    <div class="header">
        <h1>üé∞ –†—É–ª–µ—Ç–∫–∞ 3–Ø</h1>
        <button class="close-btn" onclick="closeApp()">‚úï</button>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div class="container">
        <!-- –°–µ–∫—Ü–∏—è —Å –±–∏–ª–µ—Ç–∞–º–∏ -->
        <div class="tickets-section">
            <div class="tickets-label">–≤–∞—à–∏ –±–∏–ª–µ—Ç—ã:</div>
            <div class="tickets-count">
                <i class="fas fa-ticket-alt"></i>
                <span id="ticketCount">3</span>
            </div>
        </div>

        <!-- –†—É–ª–µ—Ç–∫–∞ -->
        <div class="roulette-container">
            <div class="roulette-title">üé° –ö–†–£–¢–ò –ò –í–´–ò–ì–†–´–í–ê–ô!</div>
            <div class="roulette-wheel" id="rouletteWheel">
                <div class="roulette-pointer"></div>
                <div class="roulette-segments" id="rouletteSegments"></div>
            </div>

            <!-- –°–µ—Ç–∫–∞ –ø—Ä–∏–∑–æ–≤ -->
            <div class="prizes-grid">
                <div class="prize-card gold">
                    <div class="prize-amount">3000‚ÇΩ</div>
                    <div class="prize-name">–ó–æ–ª–æ—Ç–æ–π –ø—Ä–∏–∑</div>
                </div>
                <div class="prize-card silver">
                    <div class="prize-amount">1000‚ÇΩ</div>
                    <div class="prize-name">–°–µ—Ä–µ–±—Ä—è–Ω—ã–π –ø—Ä–∏–∑</div>
                </div>
                <div class="prize-card bronze">
                    <div class="prize-amount">500‚ÇΩ</div>
                    <div class="prize-name">–ë—Ä–æ–Ω–∑–æ–≤—ã–π –ø—Ä–∏–∑</div>
                </div>
                <div class="prize-card">
                    <div class="prize-amount">300‚ÇΩ</div>
                    <div class="prize-name">–ë–∞–∑–æ–≤—ã–π –ø—Ä–∏–∑</div>
                </div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∞ —Å–ø–∏–Ω–∞ -->
            <button class="spin-button" id="spinButton" onclick="spinRoulette()">
                <i class="fas fa-redo"></i>
                –ö–†–£–¢–ò–¢–¨ –†–£–õ–ï–¢–ö–£
            </button>
        </div>

        <!-- –î—Ä—É–≥–∏–µ —Å–µ–∫—Ü–∏–∏ (—Å–∫—Ä—ã—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
        <div class="history-section" id="historySection">
            <h2>üìú –ò—Å—Ç–æ—Ä–∏—è –≤—Ä–∞—â–µ–Ω–∏–π</h2>
            <div id="historyList"></div>
        </div>

        <div class="friends-section" id="friendsSection">
            <h2>üë• –ü—Ä–∏–≥–ª–∞—à–∞–π –¥—Ä—É–∑–µ–π</h2>
            <p>–ü–æ–ª—É—á–∞–π +1 –±–∏–ª–µ—Ç –∑–∞ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω–æ–≥–æ –¥—Ä—É–≥–∞</p>
            <div class="referral-link">
                <input type="text" id="refLink" readonly value="–ó–∞–≥—Ä—É–∑–∫–∞...">
                <button onclick="copyRefLink()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
            <div id="friendsList"></div>
        </div>

        <div class="collection-section" id="collectionSection">
            <h2>üèÜ –ö–æ–ª–ª–µ–∫—Ü–∏—è –≤—ã–∏–≥—Ä—ã—à–µ–π</h2>
            <div id="collectionList"></div>
        </div>
    </div>

    <!-- –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é -->
    <div class="bottom-menu">
        <a href="#" class="menu-item active" onclick="showSection('main')">
            <i class="fas fa-home"></i>
            <span>–ì–ª–∞–≤–Ω–∞—è</span>
        </a>
        <a href="#" class="menu-item" onclick="showSection('history')">
            <i class="fas fa-history"></i>
            <span>–ò—Å—Ç–æ—Ä–∏—è</span>
        </a>
        <a href="#" class="menu-item" onclick="showSection('friends')">
            <i class="fas fa-user-friends"></i>
            <span>–î—Ä—É–∑—å—è</span>
        </a>
        <a href="#" class="menu-item" onclick="showSection('collection')">
            <i class="fas fa-trophy"></i>
            <span>–ö–æ–ª–ª–µ–∫—Ü–∏—è</span>
        </a>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–±–µ–¥—ã -->
    <div class="modal win-modal" id="winModal">
        <div class="modal-content">
            <div class="modal-icon">üéâ</div>
            <div class="modal-title">–ü–û–ë–ï–î–ê!</div>
            <div class="modal-text" id="winPrizeText">–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ 500‚ÇΩ!</div>
            <button class="modal-button" onclick="closeModal('winModal')">–£–†–ê!</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ–∏–≥—Ä—ã—à–∞ -->
    <div class="modal lose-modal" id="loseModal">
        <div class="modal-content">
            <div class="modal-icon">üòî</div>
            <div class="modal-title">–ù–ï –†–ê–°–°–¢–†–ê–ò–í–ê–ô–°–Ø!</div>
            <div class="modal-text">
                –ë–∏–ª–µ—Ç—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å, –Ω–æ —Ç—ã —Å–º–æ–∂–µ—à—å –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞ –≤ 13:00 –ø–æ –º—Å–∫ –∏–ª–∏ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–∑–µ–π, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–µ —à–∞–Ω—Å—ã!
            </div>
            <button class="modal-button" onclick="closeModal('loseModal')">–•–û–†–û–®–û</button>
        </div>
    </div>

    <script>
        // Telegram Web App
        const tg = window.Telegram.WebApp;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        if (typeof tg !== 'undefined' && tg.initData) {
            tg.expand();
            tg.ready();
            console.log('Telegram Web App initialized');
        } else {
            console.log('Running in browser mode (not Telegram)');
        }

        // –î–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let tickets = localStorage.getItem('roulette_tickets') ? parseInt(localStorage.getItem('roulette_tickets')) : 3;
        let isSpinning = false;
        let history = [];
        let collection = [];
        let friends = [];

        // –ü—Ä–∏–∑—ã —Ä—É–ª–µ—Ç–∫–∏
        const prizes = [
            { amount: "300‚ÇΩ", value: 300, type: "prize", color: "#FF416C", weight: 10 },
            { amount: "500‚ÇΩ", value: 500, type: "prize", color: "#FF4B2B", weight: 8 },
            { amount: "1000‚ÇΩ", value: 1000, type: "prize", color: "#FFD700", weight: 5 },
            { amount: "3000‚ÇΩ", value: 3000, type: "prize", color: "#4CAF50", weight: 2 },
            { amount: "0", value: 0, type: "lose", color: "#666", weight: 20 },
            { amount: "üé´ +1", value: 1, type: "ticket", color: "#2196F3", weight: 25 },
            { amount: "üé´ +3", value: 3, type: "ticket", color: "#9C27B0", weight: 15 },
            { amount: "üé´ +5", value: 5, type: "ticket", color: "#FF416C", weight: 10 }
        ];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            // –°–æ–∑–¥–∞–µ–º —Å–µ–≥–º–µ–Ω—Ç—ã —Ä—É–ª–µ—Ç–∫–∏
            createRouletteSegments();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            loadUserData();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
            showSection('main');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –±–∏–ª–µ—Ç–æ–≤
            updateTicketCount();
            
            console.log('App initialized. Tickets:', tickets);
        });

        // –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ —Ä—É–ª–µ—Ç–∫–∏
        function createRouletteSegments() {
            const segmentsContainer = document.getElementById('rouletteSegments');
            if (!segmentsContainer) return;
            
            segmentsContainer.innerHTML = '';
            
            for (let i = 0; i < 12; i++) {
                // –õ–∏–Ω–∏—è —Å–µ–≥–º–µ–Ω—Ç–∞
                const segment = document.createElement('div');
                segment.className = 'segment';
                segment.style.transform = `rotate(${i * 30}deg)`;
                segmentsContainer.appendChild(segment);
                
                // –ó–Ω–∞—á–µ–Ω–∏–µ —Å–µ–≥–º–µ–Ω—Ç–∞
                const value = document.createElement('div');
                value.className = 'segment-value';
                const prize = prizes[i % prizes.length];
                value.textContent = prize.amount;
                value.style.color = prize.color;
                value.style.transform = `rotate(${i * 30 + 15}deg) translate(100px) rotate(${-(i * 30 + 15)}deg)`;
                segmentsContainer.appendChild(value);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function loadUserData() {
            try {
                // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ Telegram
                let userId = 'demo';
                if (typeof tg !== 'undefined' && tg.initDataUnsafe && tg.initDataUnsafe.user) {
                    userId = tg.initDataUnsafe.user.id || 'demo';
                }
                
                // –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞
                const refLinkElement = document.getElementById('refLink');
                if (refLinkElement) {
                    refLinkElement.value = `https://t.me/rullet_golden_bot?start=ref_${userId}`;
                }
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ localStorage
                const savedHistory = localStorage.getItem('roulette_history');
                const savedCollection = localStorage.getItem('roulette_collection');
                const savedFriends = localStorage.getItem('roulette_friends');
                
                if (savedHistory) {
                    try {
                        history = JSON.parse(savedHistory);
                    } catch (e) {
                        history = [];
                    }
                }
                
                if (savedCollection) {
                    try {
                        collection = JSON.parse(savedCollection);
                    } catch (e) {
                        collection = [];
                    }
                }
                
                if (savedFriends) {
                    try {
                        friends = JSON.parse(savedFriends);
                    } catch (e) {
                        friends = [];
                    }
                }
                
                console.log('User data loaded:', { tickets, history: history.length, collection: collection.length });
                
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        // –í—Ä–∞—â–µ–Ω–∏–µ —Ä—É–ª–µ—Ç–∫–∏ - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø
        function spinRoulette() {
            console.log('spinRoulette called, isSpinning:', isSpinning, 'tickets:', tickets);
            
            if (isSpinning) {
                console.log('Already spinning');
                return;
            }
            
            if (tickets <= 0) {
                console.log('No tickets left');
                showModal('loseModal');
                return;
            }
            
            // –ù–∞—á–∏–Ω–∞–µ–º –≤—Ä–∞—â–µ–Ω–∏–µ
            isSpinning = true;
            tickets--;
            localStorage.setItem('roulette_tickets', tickets.toString());
            
            const spinButton = document.getElementById('spinButton');
            const wheel = document.getElementById('rouletteWheel');
            
            if (spinButton) spinButton.disabled = true;
            if (wheel) wheel.style.transition = 'transform 3s cubic-bezier(0.2, 0.8, 0.3, 1)';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –±–∏–ª–µ—Ç–æ–≤
            updateTicketCount();
            
            // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –ø—Ä–∏–∑ —Å —É—á–µ—Ç–æ–º –≤–µ—Å–æ–≤
            const totalWeight = prizes.reduce((sum, prize) => sum + prize.weight, 0);
            let random = Math.random() * totalWeight;
            let selectedPrize = prizes[0];
            
            for (const prize of prizes) {
                random -= prize.weight;
                if (random <= 0) {
                    selectedPrize = prize;
                    break;
                }
            }
            
            console.log('Selected prize:', selectedPrize);
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è
            const spins = 5 + Math.random() * 3; // 5-8 –ø–æ–ª–Ω—ã—Ö –æ–±–æ—Ä–æ—Ç–æ–≤
            const prizeIndex = prizes.findIndex(p => p === selectedPrize);
            const degrees = spins * 360 + (prizeIndex * (360 / prizes.length)) + (360 / prizes.length / 2);
            
            if (wheel) {
                wheel.style.transform = `rotate(${degrees}deg)`;
            }
            
            // –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
            setTimeout(() => {
                console.log('Spin completed, handling prize');
                handlePrize(selectedPrize);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
                addToHistory(selectedPrize);
                
                isSpinning = false;
                if (spinButton) spinButton.disabled = false;
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä—É–ª–µ—Ç–∫—É —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    if (wheel) {
                        wheel.style.transition = 'transform 0.5s ease-out';
                        wheel.style.transform = 'rotate(0deg)';
                    }
                }, 2000);
                
            }, 3000);
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–∏–≥—Ä—ã—à–∞
        function handlePrize(prize) {
            console.log('Handling prize:', prize);
            
            if (prize.type === 'lose') {
                showModal('loseModal');
            } else {
                if (prize.type === 'ticket') {
                    tickets += prize.value;
                    localStorage.setItem('roulette_tickets', tickets.toString());
                    updateTicketCount();
                } else if (prize.type === 'prize') {
                    addToCollection(prize);
                    showWinAnimation(prize);
                }
                
                const winPrizeText = document.getElementById('winPrizeText');
                if (winPrizeText) {
                    winPrizeText.textContent = `–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${prize.amount}!`;
                }
                
                showModal('winModal');
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ Telegram –±–æ—Ç–∞, –µ—Å–ª–∏ –≤ —Ä–µ–∂–∏–º–µ Telegram
                if (typeof tg !== 'undefined' && tg.sendData) {
                    try {
                        tg.sendData(JSON.stringify({
                            action: 'spin_result',
                            prize: prize.amount,
                            type: prize.type,
                            tickets: tickets
                        }));
                    } catch (error) {
                        console.log('Could not send data to bot:', error);
                    }
                }
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –±–∏–ª–µ—Ç–æ–≤
        function updateTicketCount() {
            const ticketCountElement = document.getElementById('ticketCount');
            if (ticketCountElement) {
                ticketCountElement.textContent = tickets;
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
        function addToHistory(prize) {
            const historyItem = {
                date: new Date().toLocaleString('ru-RU'),
                prize: prize.amount,
                type: prize.type === 'lose' ? 'lose' : 'win',
                timestamp: Date.now()
            };
            
            history.unshift(historyItem);
            if (history.length > 20) history.pop();
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            try {
                localStorage.setItem('roulette_history', JSON.stringify(history));
            } catch (e) {
                console.error('Error saving history:', e);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–∞ —Å–µ–∫—Ü–∏—è –∏—Å—Ç–æ—Ä–∏–∏
            loadHistory();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function loadHistory() {
            const historyList = document.getElementById('historyList');
            if (!historyList) return;
            
            historyList.innerHTML = '';
            
            if (history.length === 0) {
                historyList.innerHTML = '<p style="text-align: center; color: #aaa; padding: 20px;">–ò—Å—Ç–æ—Ä–∏—è –≤—Ä–∞—â–µ–Ω–∏–π –ø—É—Å—Ç–∞</p>';
                return;
            }
            
            history.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = `history-item ${item.type}`;
                div.innerHTML = `
                    <div>
                        <strong>${item.prize}</strong>
                        <div style="font-size: 12px; color: #aaa;">${item.date}</div>
                    </div>
                    <div style="font-size: 24px; color: ${item.type === 'win' ? '#4CAF50' : '#666'}">
                        ${item.type === 'win' ? 'üèÜ' : 'üòî'}
                    </div>
                `;
                historyList.appendChild(div);
            });
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é
        function addToCollection(prize) {
            const collectionItem = {
                id: Date.now(),
                amount: prize.amount,
                value: prize.value,
                date: new Date().toLocaleDateString('ru-RU'),
                type: 'card'
            };
            
            collection.unshift(collectionItem);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            try {
                localStorage.setItem('roulette_collection', JSON.stringify(collection));
            } catch (e) {
                console.error('Error saving collection:', e);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            loadCollection();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function loadCollection() {
            const collectionList = document.getElementById('collectionList');
            if (!collectionList) return;
            
            collectionList.innerHTML = '';
            
            if (collection.length === 0) {
                collectionList.innerHTML = '<p style="text-align: center; color: #aaa; padding: 20px;">–ö–æ–ª–ª–µ–∫—Ü–∏—è –≤—ã–∏–≥—Ä—ã—à–µ–π –ø—É—Å—Ç–∞</p>';
                return;
            }
            
            collection.forEach(item => {
                const div = document.createElement('div');
                div.className = 'prize-card';
                div.style.borderColor = item.type === 'card' ? '#FFD700' : '#4CAF50';
                div.innerHTML = `
                    <div class="prize-amount">${item.amount}</div>
                    <div class="prize-name">${item.type === 'card' ? '–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –∫–∞—Ä—Ç–∞' : '–ë–∏–ª–µ—Ç—ã'}</div>
                    <div style="font-size: 12px; color: #aaa; margin-top: 5px;">${item.date}</div>
                `;
                collectionList.appendChild(div);
            });
        }

        // –ü–æ–∫–∞–∑ –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ–±–µ–¥—ã
        function showWinAnimation(prize) {
            // –ö–æ–Ω—Ñ–µ—Ç—Ç–∏
            try {
                confetti({
                    particleCount: 150,
                    spread: 70,
                    origin: { y: 0.6 }
                });
            } catch (e) {
                console.log('Confetti error:', e);
            }
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –ø–∞–¥–∞—é—â–µ–π –∫–∞—Ä—Ç–æ—á–∫–∏
            const card = document.createElement('div');
            card.className = 'winning-card';
            card.style.background = prize.color || '#FF416C';
            card.style.width = '100px';
            card.style.height = '60px';
            card.style.borderRadius = '10px';
            card.style.display = 'flex';
            card.style.alignItems = 'center';
            card.style.justifyContent = 'center';
            card.style.color = 'white';
            card.style.fontWeight = 'bold';
            card.style.fontSize = '20px';
            card.textContent = prize.amount;
            card.style.top = '50%';
            card.style.left = '50%';
            card.style.position = 'fixed';
            card.style.zIndex = '9999';
            card.style.transform = 'translate(-50%, -50%)';
            
            document.body.appendChild(card);
            
            // –£–±–∏—Ä–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
            setTimeout(() => {
                if (card.parentNode) {
                    card.parentNode.removeChild(card);
                }
            }, 2000);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥—Ä—É–∑–µ–π
        function loadFriends() {
            const friendsList = document.getElementById('friendsList');
            if (!friendsList) return;
            
            if (friends.length === 0) {
                friendsList.innerHTML = '<p style="text-align: center; color: #aaa; padding: 20px;">–ü–æ–∫–∞ –ø—É—Å—Ç–æ. –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Å–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π</p>';
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–µ–∫—Ü–∏—é
        function showSection(section) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏
            const sections = ['roulette-container', 'historySection', 'friendsSection', 'collectionSection'];
            sections.forEach(sectionId => {
                const element = document.getElementById(sectionId) || 
                               (sectionId === 'roulette-container' ? document.querySelector('.roulette-container') : null);
                if (element) {
                    element.style.display = 'none';
                }
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é —Å–µ–∫—Ü–∏—é
            if (section === 'main') {
                const mainSection = document.querySelector('.roulette-container');
                if (mainSection) mainSection.style.display = 'block';
            } else {
                const sectionElement = document.getElementById(section + 'Section');
                if (sectionElement) sectionElement.style.display = 'block';
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é
            document.querySelectorAll('.menu-item').forEach((item, index) => {
                item.classList.remove('active');
            });
            
            const menuIndex = { 'main': 0, 'history': 1, 'friends': 2, 'collection': 3 }[section];
            const menuItems = document.querySelectorAll('.menu-item');
            if (menuItems[menuIndex]) {
                menuItems[menuIndex].classList.add('active');
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–µ–∫—Ü–∏–∏
            if (section === 'history') loadHistory();
            if (section === 'collection') loadCollection();
            if (section === 'friends') loadFriends();
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'flex';
            }
        }

        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
            }
        }

        // –ó–∞–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        function closeApp() {
            if (typeof tg !== 'undefined' && tg.close) {
                tg.close();
            } else {
                alert('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –∑–∞–∫—Ä—ã—Ç–æ —Ç–æ–ª—å–∫–æ –≤ Telegram');
            }
        }

        // –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É
        function copyRefLink() {
            const refLink = document.getElementById('refLink');
            if (!refLink) return;
            
            refLink.select();
            refLink.setSelectionRange(0, 99999);
            
            try {
                document.execCommand('copy');
                alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
            } catch (err) {
                console.error('Copy failed:', err);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É');
            }
        }
    </script>
</body>
</html>
